package com.chiddu.malwareservice.malwareService.dao;

import com.chiddu.malwareservice.malwareService.model.MalwareUrl;
import org.hibernate.Session;
import org.hibernate.query.Query;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;
import java.io.Serializable;
import java.util.List;

@Repository
public class MalwareLookupDAOimpl implements  MalwareLookupDAO{

    @Autowired
    private EntityManager entityManager;

    @Override
    public List<MalwareUrl> get() {
        Session cur = entityManager.unwrap(Session.class);
        Query<MalwareUrl> q =  cur.createQuery("from MalwareUrl",MalwareUrl.class);

        List<MalwareUrl> malwareUrls = q.getResultList();
        return malwareUrls;
    }

    /**
     * This method is responsible for get a session object and using that to
     * create a query to check if the domain that is sent is availbale in our
     * malware database list.
     *
     * @param url
     * @return Malware
     * @throws
     * @see
     */


    @Override
    public MalwareUrl get(String url) {

        String hql = "from MalwareUrl where url like :url";
        Session cur = entityManager.unwrap(Session.class);
        Query query = cur.createQuery(hql);
        query.setParameter("url", "%" + url + "%");
        MalwareUrl m = (MalwareUrl) query.uniqueResult();
        if(m!=null)
            System.out.println("GOT RESULT FROM DATABASE" + m.getUrl());
        return m;
    }

    @Override
    public void save(MalwareUrl m) {
        Session cur = entityManager.unwrap(Session.class);
        cur.save(m);
    }

    @Override
    public void delete(int id) {

    }
}
